jstestdriver.VisualTestReporter=function(b,d,a,c){this.finished_=false;this.success_=1;this.report_="";this.filesLoaded_=[];this.testResults_=[];this.createNode_=b;this.appendToBody_=d;this.jQuery_=a;this.parseJson_=c;this.passed_=0;this.testTime_=new jstestdriver.VisualTestReporter.Interval();this.loadTime_=new jstestdriver.VisualTestReporter.Interval()};jstestdriver.VisualTestReporter.prototype.isFinished=function(){return this.finished_};jstestdriver.VisualTestReporter.prototype.getReport=function(){return this.report_};jstestdriver.VisualTestReporter.prototype.getNumFilesLoaded=function(){return this.filesLoaded_.length};jstestdriver.VisualTestReporter.prototype.setIsFinished=function(h){this.finished_=h;if(h){var b=this.createNode_("div");this.jQuery_(b).attr("id","JsTDVisualResults");b.className="results";var e=this.createNode_("div");e.className="details";var f={};for(var d=0,a=this.testResults_[d];a=this.testResults_[d];d++){if(!f[a.testCaseName]||(f[a.testCaseName]==jstestdriver.TestResult.RESULT.PASSED)){f[a.testCaseName]=a.result}this.renderResult(a,e)}var g=[];for(caseName in f){g.push(jstestdriver.formatString('<div class="%s">%s [%s]</div>',f[caseName],caseName,f[caseName].toUpperCase()))}g.sort();var c=b.appendChild(this.createNode_("div"));c.className="summary";c.innerHTML=jstestdriver.formatString('<h2>Summary:</h2><div class="cases">%s</div><p>%s out of %s tests passed in %ds.</p><h2>Details:</h2>',g.join(""),this.passed_,this.testResults_.length,this.testTime_.toSeconds());this.renderFilesLoaded(b);b.appendChild(e);this.appendToBody_(b)}};jstestdriver.VisualTestReporter.prototype.renderFilesLoaded=function(b){var a=b.appendChild(this.createNode_("div"));a.className="load";a.innerHTML=jstestdriver.formatString("%s files loaded in %ds",this.filesLoaded_.length,this.loadTime_.toSeconds())};jstestdriver.VisualTestReporter.prototype.renderResult=function(l,k){var a=this.createNode_("div");a.className=l.result;var c=[jstestdriver.formatString("%s.%s [%s] in %d ms",l.testCaseName,l.testName,l.result.toUpperCase(),l.time)];var j;try{j=l.message.length?this.parseJson_(l.message):[]}catch(d){j="Error parsing test result: "+d.message+"\nmessage:"+l.message+"\n"}while(j.length){var g=j.pop();c.push('<div class="message">'+g.message+"</div>");if(g.stack){var f=g.stack.split("\n");var h=[];for(var b=0;f[b];b++){if(f[b].indexOf("/test/")!=-1){h.push(f[b])}}c.push('<div class="stack">'+h.join("\n")+"</div>")}}if(l.result!=jstestdriver.TestResult.RESULT.PASSED){c.push('<div class="log">'+l.log+"</div>")}a.innerHTML=c.join("");k.appendChild(a)};jstestdriver.VisualTestReporter.prototype.setIsSuccess=function(a){this.success_=a};jstestdriver.VisualTestReporter.prototype.addTestResult=function(a){this.testResults_.push(a)};jstestdriver.VisualTestReporter.prototype.isSuccess=function(){return !!this.success_};jstestdriver.VisualTestReporter.prototype.updateIsSuccess=function(a){this.passed_+=Number(a);this.success_=a&this.success_};jstestdriver.VisualTestReporter.prototype.setReport=function(a){this.report_=a};jstestdriver.VisualTestReporter.prototype.addLoadedFileResults=function(a){this.filesLoaded_=this.filesLoaded_.concat(a)};jstestdriver.VisualTestReporter.prototype.startLoading=function(a){this.loadTime_.start=a};jstestdriver.VisualTestReporter.prototype.finishLoading=function(a){this.loadTime_.stop=a};jstestdriver.VisualTestReporter.prototype.finishTests=function(a){this.testTime_.stop=a};jstestdriver.VisualTestReporter.prototype.startTests=function(a){this.testTime_.start=a};jstestdriver.VisualTestReporter.prototype.toString=function(){return"VisualTestReporter(success=["+this.success_+"], finished=["+this.finished_+"], lastTestResult=["+this.lastTestResult_+"], filesLoaded=["+this.filesLoaded_+"])"};jstestdriver.VisualTestReporter.Interval=function(){this.start=0;this.stop=0};jstestdriver.VisualTestReporter.Interval.prototype.toSeconds=function(){return(this.stop-this.start)/1000};