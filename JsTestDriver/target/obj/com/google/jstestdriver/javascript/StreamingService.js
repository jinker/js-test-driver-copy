jstestdriver.StreamingService=function(d,c,e,b,f,a){this.url_=d;this.now_=c;this.post_=e;this.activeResponses_={};this.finishedResponses_={};this.completeFinalResponse=null;this.synchPost_=b;this.setTimeout_=f;this.unloadSignal_=a};jstestdriver.StreamingService.prototype.synchClose=function(a){var b=new jstestdriver.CommandResponse(true,a);this.synchPost_(this.url_,b);this.unloadSignal_.set(true)};jstestdriver.StreamingService.prototype.stream=function(a,b){this.streamResponse(a,false,b)};jstestdriver.StreamingService.prototype.streamResponse=function(b,a,e){var d=new jstestdriver.CommandResponse(a,b);if(!a&&b!=null){d.responseId=this.now_();this.activeResponses_[d.responseId]=d}var c=this;this.setTimeout_(function(){c.post_(c.url_,d,e,"text/plain")},1)};jstestdriver.StreamingService.prototype.streamAcknowledged=function(b){for(var a=0;b&&b[a];a++){if(this.activeResponses_[b[a]]){this.activeResponses_[b[a]]=null;delete this.activeResponses_[b[a]];this.finishedResponses_[b[a]]=true}}if(this.completeFinalResponse){this.completeFinalResponse()}};jstestdriver.StreamingService.prototype.close=function(b,c){var a=this;this.completeFinalResponse=function(){if(a.hasOpenResponses()){a.streamResponse(null,false,c)}else{a.completeFinalResponse=null;a.activeResponses_={};a.finishedResponses_={};a.streamResponse(b,true,c);this.unloadSignal_.set(true)}};this.completeFinalResponse()};jstestdriver.StreamingService.prototype.hasOpenResponses=function(){for(var a in this.activeResponses_){if(this.activeResponses_.hasOwnProperty(a)){return true}}return false};